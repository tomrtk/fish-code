workflow:
  rules:
    - if: $CI_MERGE_REQUEST_ID

variables:
  CHILD_PWD: "core"

default:
  tags:
    - bachelor
  image: registry.gitlab.com/hitchhikers/container-images/python-quality:latest

style:
  before_script:
    - cd $CHILD_PWD
    - pwd
  script:
    - isort --check --diff .
    - black --check --diff .

docs:
  before_script:
    - cd $CHILD_PWD
  script:
    - pydocstyle
  allow_failure: true

pyright:
  before_script:
    - cd $CHILD_PWD
    - poetry install
  script:
    - poetry run pyright .
  allow_failure: true

# tests:
#   before_script:
#     - cd $CHILD_PWD
#     - poetry config experimental.new-installer false
#     - poetry install
#     - source .venv/bin/activate
#     - python3 --version
#   script:
#     - pytest
#     - coverage run -m pytest
#     - coverage xml
#     - coverage report
#   artifacts:
#     reports:
#       cobertura: $CHILD_PWD/coverage.xml

testtox:
  before_script:
    - cd $CHILD_PWD
    # - poetry config experimental.new-installer false
    # - poetry install
    # - source .venv/bin/activate
    - pip install tox
    - python3 --version
  script:
    - tox
  artifacts:
    reports:
      cobertura: $CHILD_PWD/coverage.xml
