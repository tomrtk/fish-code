default:
  tags:
    - bachelor
  image: registry.gitlab.com/hitchhikers/container-images/python-quality:latest

style:
  script:
    - isort --check --diff .
    - black --check --diff .
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      changes:
        - ui/*
    - when: never

docs:
  script:
    - pydocstyle
  allow_failure: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      changes:
        - ui/*
    - when: never

pyright:
  before_script:
    - poetry install
  script:
    - poetry run pyright .
  allow_failure: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      changes:
        - ui/*
    - when: never

tests:
  before_script:
    - poetry install
  script:
    - poetry run pytest --cov --cov-report xml
    - poetry run coverage report
  artifacts:
    reports:
      cobertura: coverage.xml
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      changes:
        - ui/*
    - when: never
